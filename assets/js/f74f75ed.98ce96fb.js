"use strict";(self.webpackChunkdocusaurus_blog=self.webpackChunkdocusaurus_blog||[]).push([[3695],{40281:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>_,frontMatter:()=>d,metadata:()=>l,toc:()=>o});var t=s(74848),i=s(28453);const d={title:"MySQL \uc778\ub371\uc2a4 \ud1b5\uacc4",slug:"2021/06/17/mysql-index-statistics",date:new Date("2021-06-17T13:00:00.000Z"),categories:["mysql"],tags:["mysql","index","index-statistics"]},a=void 0,l={permalink:"/2021/06/17/mysql-index-statistics",source:"@site/blog/mysql-index-statistics.md",title:"MySQL \uc778\ub371\uc2a4 \ud1b5\uacc4",description:"\ucffc\ub9ac\ub97c \uc2e4\ud589\uc2dc\uc5d0 \uc608\uc0c1\ud588\ub358 \uc778\ub371\uc2a4\ub97c \ud0c0\uc9c0 \uc54a\ub294 \ud604\uc0c1\uc744 \uc54c\uc544\ubcf4\uace0\uc790 \ud569\ub2c8\ub2e4.",date:"2021-06-17T13:00:00.000Z",tags:[{inline:!0,label:"mysql",permalink:"/tags/mysql"},{inline:!0,label:"index",permalink:"/tags/index"},{inline:!0,label:"index-statistics",permalink:"/tags/index-statistics"}],readingTime:4.7,hasTruncateMarker:!0,authors:[],frontMatter:{title:"MySQL \uc778\ub371\uc2a4 \ud1b5\uacc4",slug:"2021/06/17/mysql-index-statistics",date:"2021-06-17T13:00:00.000Z",categories:["mysql"],tags:["mysql","index","index-statistics"]},unlisted:!1,prevItem:{title:"Spring WebSocket (with STOMP)",permalink:"/2021/07/15/spring-websocket-with-stomp"},nextItem:{title:"Amazon Linux\uc5d0\uc11c /var/log\uac00 \uaf49\ucc28\ub294 \uc774\uc288",permalink:"/2021/05/23/amazone-linux-log-issue"}},r={authorsImageUrls:[]},o=[{value:"\ud14c\uc774\ube14 \uc0dd\uc131",id:"\ud14c\uc774\ube14-\uc0dd\uc131",level:3},{value:"explain",id:"explain",level:3},{value:"innodb_index_stats",id:"innodb_index_stats",level:3},{value:"\uc778\ub371\uc2a4 \ud1b5\uacc4 \uad6c\uc131\ubc95",id:"\uc778\ub371\uc2a4-\ud1b5\uacc4-\uad6c\uc131\ubc95",level:3},{value:"1. innodb_stats_persistent=ON",id:"1-innodb_stats_persistenton",level:4},{value:"2. innodb_stats_persistent=OFF",id:"2-innodb_stats_persistentoff",level:4},{value:"3. ANALYZE TABLE <code>table_name</code>",id:"3-analyze-table-table_name",level:4},{value:"\uadf8\ub807\ub2e4\uba74 \uc5b4\ub5bb\uac8c \ud574\uc57c\ud560\uae4c?",id:"\uadf8\ub807\ub2e4\uba74-\uc5b4\ub5bb\uac8c-\ud574\uc57c\ud560\uae4c",level:3},{value:"\ucc38\uace0",id:"\ucc38\uace0",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\ucffc\ub9ac\ub97c \uc2e4\ud589\uc2dc\uc5d0 \uc608\uc0c1\ud588\ub358 \uc778\ub371\uc2a4\ub97c \ud0c0\uc9c0 \uc54a\ub294 \ud604\uc0c1\uc744 \uc54c\uc544\ubcf4\uace0\uc790 \ud569\ub2c8\ub2e4."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\ub2e4\uc74c\uacfc \uac19\uc740 \ud14c\uc774\ube14\uc774 \uc788\ub2e4\uace0 \uac00\uc815\ud574\ubcf4\uc790."}),"\n",(0,t.jsx)(n.h3,{id:"\ud14c\uc774\ube14-\uc0dd\uc131",children:"\ud14c\uc774\ube14 \uc0dd\uc131"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE `payment_history` (\n    `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT, -- \uacb0\uc81c id\n    `user_id` varchar(100) DEFAULT NULL, -- \uc720\uc800 \uc815\ubcf4\n    `status` varchar(10) DEFAULT NULL, -- \uacb0\uc81c \uc0c1\ud0dc\n    ...\n    PRIMARY KEY (`id`),\n    KEY `idx_user_id` (`user_id`),\n    KEY `idx_user_id_status` (`user_id`, `status`),\n    ...\n)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"explain",children:"explain"}),"\n",(0,t.jsx)(n.p,{children:"\uadf8\ub9ac\uace0 \ub2e4\uc74c\uacfc \uac19\uc740 \ucffc\ub9ac\ub97c \uc2e4\ud589\ud55c\ub2e4\uba74 \uc5b4\ub5a4 \uc778\ub371\uc2a4\ub97c \ud0c0\uac8c \ub420\uae4c\uc694?"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT  *\nFROM    `payment_history`\nWHERE   `user_id` = 'AAAAAAA'\nAND     `status` = 'Completed'\n"})}),"\n",(0,t.jsx)(n.p,{children:"\ub2e4\uc74c\uacfc \uac19\uc740 \uc2e4\ud589 \uacc4\ud68d\uc744 \uc608\uc0c1\ud574\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"... | possible_keys                   | key                | ... | rows  | ...\n------------------------------------------------------------------------\n... | idx_user_id, idx_user_id_status | idx_user_id_status | ... | 17714 | ...\n"})}),"\n",(0,t.jsx)(n.p,{children:"\ud558\uc9c0\ub9cc \uacbd\uc6b0\uc5d0 \ub530\ub77c, \uc774\ub294 \ub2e4\ub978 \uc2e4\ud589 \uacc4\ud68d \uacb0\uacfc\uac00 \ub3c4\ucd9c\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"... | possible_keys                   | key                | ... | rows  | ...\n------------------------------------------------------------------------\n... | idx_user_id, idx_user_id_status | idx_user_id        | ... | 16670 | ...\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\uadf8 \uc774\uc720\ub294 ",(0,t.jsx)(n.strong,{children:"\uc635\ud2f0\ub9c8\uc774\uc800\uac00 \uc608\uc0c1\uacfc \ub2e4\ub978 \uc778\ub371\uc2a4\ub97c \ud0d0\uc0c9"}),"\ud588\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4. \uc635\ud2f0\ub9c8\uc774\uc800\ub294 \ucd5c\uc801\uc758 \uc2e4\ud589\uacc4\ud68d\uc744 \uc138\uc6b0\uae30 \uc704\ud574 \uc778\ub371\uc2a4 \ud1b5\uacc4 \uc815\ubcf4\ub97c \uc758\uc874\ud558\uac8c \ub418\ub294\ub370, MySQL \uac19\uc740 \uacbd\uc6b0\ub294 ",(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.6/en/innodb-persistent-stats.html#innodb-index-stats-table",children:(0,t.jsx)(n.code,{children:"mysql.innodb_index_stats"})})," \ub77c\ub294 \ud14c\uc774\ube14\uc5d0\uc11c \ud574\ub2f9 \uc815\ubcf4\ub97c \uc5bb\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.h3,{id:"innodb_index_stats",children:"innodb_index_stats"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT  *\nFROM    `mysql.innodb_index_stats`\nWHERE   `database_name` = 'test' \nAND     `table_name` = 'payment_history';\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"... | table_name      | index_name         | ... | stat_name    | stat_value | ... | stat_description\n-------------------------------------------------------------------------------------------------------------------------\n... | payment_history | PRIMARY            | ... | n_diff_pfx01 |        ... | ... | id\n... | payment_history | PRIMARY            | ... | n_leaf_pages |        ... | ... | Number of leaf pages in the index\n... | payment_history | PRIMARY            | ... | size         |        ... | ... | Number of pages in the index\n... | payment_history | idx_user_id        | ... | n_diff_pfx01 |  1,360,401 | ... | id\n... | payment_history | idx_user_id        | ... | n_diff_pfx02 | 17,432,752 | ... | user_id,id\n... | payment_history | idx_user_id        | ... | n_leaf_pages |     66,084 | ... | Number of leaf pages in the index\n... | payment_history | idx_user_id        | ... | size         |     75,904 | ... | Number of pages in the index\n... | payment_history | idx_user_id_status | ... | n_diff_pfx01 |  1,566,677 | ... | user_id\n... | payment_history | idx_user_id_status | ... | n_diff_pfx02 |  1,660,688 | ... | user_id,status\n... | payment_history | idx_user_id_status | ... | n_diff_pfx03 | 15,970,551 | ... | user_id,status,id\n... | payment_history | idx_user_id_status | ... | n_leaf_pages |     81,288 | ... | Number of leaf pages in the index\n... | payment_history | idx_user_id_status | ... | size         |     93,540 | ... | Number of pages in the index\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\uc5ec\uae30\uc11c \uac01 \uc778\ub371\uc2a4\uc5d0 \ub300\ud55c ",(0,t.jsx)(n.code,{children:"stat_value"}),"\ub97c \ubcf4\uace0 \ub300\ub7b5\uc801\uc73c\ub85c \ud310\ub2e8\ud560 \uc218 \uc788\ub294\uac74, \uc704 \ucffc\ub9ac\uc5d0\uc11c ",(0,t.jsx)(n.code,{children:"idx_user_id"}),"\ub97c \ud0d0\uc0c9\ud558\ub294 \uac83\uc774 \ubcf4\ub2e4 \ube60\ub974\ub2e4\ub294 \uac83\uc744 \uae30\ub300\ud560 \uc218 \uc788\uc744 \uac83 \uac19\uc2b5\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.h3,{id:"\uc778\ub371\uc2a4-\ud1b5\uacc4-\uad6c\uc131\ubc95",children:"\uc778\ub371\uc2a4 \ud1b5\uacc4 \uad6c\uc131\ubc95"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.6/en/innodb-performance-optimizer-statistics.html",children:"https://dev.mysql.com/doc/refman/5.6/en/innodb-performance-optimizer-statistics.html"})}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"1-innodb_stats_persistenton",children:"1. innodb_stats_persistent=ON"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.6/en/innodb-parameters.html#sysvar_innodb_stats_persistent",children:"innodb_stats_persistent"}),"\uc740 MySQL 5.6.2\uc5d0\uc11c \uc0dd\uacbc\uc73c\uba70, 5.6.6\ubd80\ud130 \uae30\ubcf8\uac12\uc774 ON\uc785\ub2c8\ub2e4."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.6/en/innodb-parameters.html#sysvar_innodb_stats_auto_recalc",children:"innodb_stats_auto_recalc"}),"\uc740 \uc790\ub3d9 \uacc4\uc0b0 \uc5ec\ubd80\ub97c \uc9c0\uc815\ud558\ub294 \uc635\uc158\uc785\ub2c8\ub2e4. (\uae30\ubcf8\uac12\uc740 ON) \ud14c\uc774\ube14\uc758 10% \ubcc0\uacbd\uc774 \uc788\uc744 \ub54c \uc7ac\uacc4\uc0b0\uc744 \ud558\ub294\ub370, \uc544\uc27d\uac8c\ub3c4 \uc774 \uac12\uc740 \ud558\ub4dc\ucf54\ub529 \ub418\uc5b4\uc788\uc5b4 \ubcc0\uacbd\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. (",(0,t.jsx)(n.a,{href:"https://github.com/mysql/mysql-server/blob/5.6/storage/innobase/row/row0mysql.cc#L1106",children:"mysql/mysql-server"}),")"]}),"\n",(0,t.jsx)(n.h4,{id:"2-innodb_stats_persistentoff",children:"2. innodb_stats_persistent=OFF"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.6/en/innodb-parameters.html#sysvar_innodb_stats_on_metadata",children:"innodb_stats_on_metadata"}),"\uc744 ON\ud558\uba74 \ub2e4\uc74c \ucffc\ub9ac\uc2dc \uc7ac\uacc4\uc0b0\uc744 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. (\uae30\ubcf8\uac12\uc740 OFF)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"SHOW TABLE STATUS"}),"\n",(0,t.jsx)(n.li,{children:"SHOW INDEX"}),"\n",(0,t.jsx)(n.li,{children:"INFORMATION_SCHEMA.TABLES"}),"\n",(0,t.jsx)(n.li,{children:"INFORMATION_SCHEMA.STATISTICS"}),"\n"]}),"\n",(0,t.jsxs)(n.h4,{id:"3-analyze-table-table_name",children:["3. ANALYZE TABLE ",(0,t.jsx)(n.code,{children:"table_name"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.a,{href:"https://dev.mysql.com/doc/refman/5.6/en/analyze-table.html",children:["ANALYZE TABLE ",(0,t.jsx)(n.code,{children:"table_name"})]})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\uc778\ub371\uc2a4 \ud1b5\uacc4 \ud14c\uc774\ube14\uc744 \uc7ac\uacc4\uc0b0\ud569\ub2c8\ub2e4."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\ud558\uc9c0\ub9cc \uc5ed\uc2dc \ub9c9\uc4f0\ub294\uac8c \uc544\ub2cc \uac83\uc774... \ub108\ubb34 \ub290\ub9ac\uae30\ub3c4 \ud558\uace0 \ud14c\uc774\ube14 read lock\uc774 \uac78\ub9ac\uae30 \ub54c\ubb38\uc5d0 \uc870\uc2ec\ud574\uc11c \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"During the analysis, the table is locked with a read lock for InnoDB and MyISAM."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\ub610\ud55c \uc7ac\uacc4\uc0b0\ud55c\ub2e4\uace0 \uc88b\uc544\uc9c4\ub2e4\ub294 \ubcf4\uc7a5\uc774 \uc5c6\uc2b5\ub2c8\ub2e4. \uacb0\uad6d \ub79c\ub364\uc73c\ub85c \uc0d8\ud50c\ub9c1\uc744 \ud558\uae30 \ub54c\ubb38\uc5d0 \uc88b\uc544\uc9c8 \uc218\ub3c4, \ub098\ube60\uc9c8 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\uadf8\ub807\ub2e4\uba74-\uc5b4\ub5bb\uac8c-\ud574\uc57c\ud560\uae4c",children:"\uadf8\ub807\ub2e4\uba74 \uc5b4\ub5bb\uac8c \ud574\uc57c\ud560\uae4c?"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\ud14c\uc774\ube14 \ubcc4\ub85c ",(0,t.jsx)(n.code,{children:"innodb_stats_persistent_sample_pages"}),"\ub97c \uc870\uc808\ud558\uc790"]}),"\n",(0,t.jsxs)(n.li,{children:["\uc801\uc808\ud788 ",(0,t.jsx)(n.code,{children:"ANALYZE TABLE"}),"\ub97c \uc0ac\uc6a9\ud558\uc790"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\ucc38\uace0",children:"\ucc38\uace0"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.6/en/innodb-performance-optimizer-statistics.html",children:"https://dev.mysql.com/doc/refman/5.6/en/innodb-performance-optimizer-statistics.html"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.6/en/innodb-analyze-table-complexity.html",children:"https://dev.mysql.com/doc/refman/5.6/en/innodb-analyze-table-complexity.html"})}),"\n"]})]})}function _(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var t=s(96540);const i={},d=t.createContext(i);function a(e){const n=t.useContext(d);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(d.Provider,{value:n},e.children)}}}]);